<main class="settings-main">
  <div class="settings-page">
    <!-- Header -->
    <div class="mb-8">
      <h2 class="page-title">Settings</h2>
      <p class="page-subtitle">
        Manage system configuration and preferences
      </p>
    </div>

    <div class="settings-content">
      <!-- API Configuration -->
      <section class="card">
        <div class="card-header">
          <div class="icon-wrapper icon-blue">
            <!-- key icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4" />
              <path d="m21 2-9.6 9.6" />
              <circle cx="7.5" cy="15.5" r="5.5" />
            </svg>
          </div>
          <div>
            <h3 class="card-title">API Configuration</h3>
            <p class="card-subtitle">
              Manage API keys and authentication
            </p>
          </div>
        </div>

        <div class="card-body space-y-4">
          <div>
            <label class="field-label">Master API Key</label>
            <input type="password" [value]="apiConfig.masterApiKeyMasked" readonly
              class="input-control input-readonly" />
          </div>

          <div>
            <label class="field-label">Webhook URL</label>
            <input type="url" placeholder="https://your-domain.com/webhook" class="input-control"
              [(ngModel)]="apiConfig.webhookUrl" name="webhookUrl" />
          </div>

          <button class="btn-primary btn-with-icon" type="button" (click)="onSaveApiSettings()">
            <!-- save icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" />
              <path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7" />
              <path d="M7 3v4a1 1 0 0 0 1 1h7" />
            </svg>
            <span>Save API Settings</span>
          </button>
        </div>
      </section>

      <!-- Notifications -->
      <section class="card">
        <div class="card-header">
          <div class="icon-wrapper icon-purple">
            <!-- bell icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10.268 21a2 2 0 0 0 3.464 0" />
              <path
                d="M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326" />
            </svg>
          </div>
          <div>
            <h3 class="card-title">Notifications</h3>
            <p class="card-subtitle">
              Configure alert preferences
            </p>
          </div>
        </div>

        <div class="card-body">
          <div class="settings-list">
           @for(n of notificationSettings; track $index;){ <label class="settings-item" >
              <input type="checkbox" class="settings-checkbox" [checked]="n.enabled"
                (change)="onToggleNotification(n)" />
              <div>
                <p class="settings-item-title">
                  {{ n.label }}
                </p>
                <p class="settings-item-desc">
                  {{ n.description }}
                </p>
              </div>
            </label>
          }
          </div>
        </div>
      </section>

      <!-- Security -->
      <section class="card">
        <div class="card-header">
          <div class="icon-wrapper icon-green">
            <!-- shield icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z" />
            </svg>
          </div>
          <div>
            <h3 class="card-title">Security</h3>
            <p class="card-subtitle">
              Manage security and access controls
            </p>
          </div>
        </div>

        <div class="card-body space-y-4">
          <div>
            <label class="field-label">Session Timeout (minutes)</label>
            <input type="number" class="input-control" [(ngModel)]="security.sessionTimeoutMinutes"
              name="sessionTimeout" (blur)="onSaveSecurity()" />
          </div>

          <div>
            <label class="settings-item">
              <input type="checkbox" class="settings-checkbox" [(ngModel)]="security.requireTwoFactor"
                name="requireTwoFactor" (change)="onSaveSecurity()" />
              <div>
                <p class="settings-item-title">
                  Require two-factor authentication
                </p>
                <p class="settings-item-desc">
                  Add an extra layer of security to user accounts
                </p>
              </div>
            </label>
          </div>

          <div>
            <label class="settings-item">
              <input type="checkbox" class="settings-checkbox" [(ngModel)]="security.ipWhitelistEnabled"
                name="ipWhitelist" (change)="onSaveSecurity()" />
              <div>
                <p class="settings-item-title">
                  IP whitelist
                </p>
                <p class="settings-item-desc">
                  Restrict access to specific IP addresses
                </p>
              </div>
            </label>
          </div>
        </div>
      </section>

      <!-- Data Management -->
      <section class="card">
        <div class="card-header">
          <div class="icon-wrapper icon-orange">
            <!-- database icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <ellipse cx="12" cy="5" rx="9" ry="3" />
              <path d="M3 5V19A9 3 0 0 0 21 19V5" />
              <path d="M3 12A9 3 0 0 0 21 12" />
            </svg>
          </div>
          <div>
            <h3 class="card-title">Data Management</h3>
            <p class="card-subtitle">
              Configure data retention and export settings
            </p>
          </div>
        </div>

        <div class="card-body space-y-4">
          <div>
            <label class="field-label">
              Data Retention Period (days)
            </label>
            <select class="input-control" [(ngModel)]="dataManagement.retentionPeriod" name="retentionPeriod">
            @for (opt of retentionOptions; track $index) {<option >
                {{ opt }}
              </option>
            }
            </select>
          </div>

          <div class="warning-box">
            <p class="warning-text">
              <span class="warning-strong">Warning:</span>
              Changing data retention settings may affect compliance requirements.
            </p>
          </div>

          <button class="btn-danger" type="button" (click)="onExportAllData()">
            Export All Data
          </button>
        </div>
      </section>

      <!-- Default Panel Configuration -->
      <section class="card">
        <div class="card-body">
          <div class="mb-4">
            <h3 class="card-title">
              Default Panel Configuration
            </h3>
            <p class="card-subtitle">
              Baseline settings for new panel providers
            </p>
          </div>

          <div class="panel-grid">
            <div>
              <label class="field-label">
                Default Quality Threshold (%)
              </label>
              <input type="number" class="input-control" [(ngModel)]="panelDefaults.qualityThreshold"
                name="qualityThreshold" />
            </div>

            <div>
              <label class="field-label">
                Default Max CPI ($)
              </label>
              <input type="number" step="0.1" class="input-control" [(ngModel)]="panelDefaults.maxCpi" name="maxCpi" />
            </div>
          </div>

          <div class="mt-4">
            <label class="field-label">
              Default Redirect Timeout (seconds)
            </label>
            <input type="number" class="input-control" [(ngModel)]="panelDefaults.redirectTimeoutSeconds"
              name="redirectTimeout" />
          </div>
        </div>

        <div class="card-footer">
          <button type="button" class="btn-secondary" (click)="onResetDefaults()">
            Reset to Defaults
          </button>

          <button type="button" class="btn-primary btn-with-icon" (click)="onSaveAllSettings()">
            <!-- save icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" />
              <path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7" />
              <path d="M7 3v4a1 1 0 0 0 1 1h7" />
            </svg>
            <span>Save All Settings</span>
          </button>
        </div>
      </section>
    </div>
  </div>
</main>